<!DOCTYPE html>
<html>
<head>
    <title>OrbitLink - Space Communication Simulator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>

body {
    margin: 0;
    text-align: center;
    font-family: Arial;
    color: white;
    overflow-x: hidden;
    background: black;
}

/* Animated stars */
.stars {
    width: 100%;
    height: 100%;
    background: transparent url("https://www.transparenttextures.com/patterns/stardust.png") repeat;
    position: fixed;
    top: 0;
    left: 0;
    z-index: -1;
    animation: moveStars 60s linear infinite;
}

@keyframes moveStars {
    from { background-position: 0 0; }
    to { background-position: 10000px 5000px; }
}

.container {
    max-width: 900px;
    margin: auto;
    padding: 20px;
}

input, select {
    padding: 12px;
    width: 90%;
    max-width: 400px;
    margin: 10px 0;
    border-radius: 6px;
    border: none;
}

button {
    padding: 12px 25px;
    background-color: orange;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    cursor: pointer;
}

.box {
    margin-top: 25px;
    padding: 20px;
    background-color: rgba(255,255,255,0.1);
    border-radius: 12px;
    width: 95%;
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
}

img {
    max-width: 100%;
    height: auto;
    border-radius: 10px;
}

a {
    color: orange;
    text-decoration: none;
}

/* Mobile specific tweaks */
@media (max-width: 600px) {
    h1 {
        font-size: 24px;
    }

    h3 {
        font-size: 16px;
    }

    button {
        width: 95%;
    }
}

</style>
</head>
<body>

<div class="stars"></div>
<div class="container">

    <div class="stars"></div>
<h3>
    Welcome, {{ user }} ğŸš€ |
    <a href="/logout">Logout</a>
</h3>

<h1>ğŸŒŒ OrbitLink</h1>
<h3>Earth â†” Mars Communication Simulator</h3>

<form method="POST">
    <input type="text" name="message" placeholder="Type message to Mars" required>
    <button type="submit">Send ğŸš€</button>
</form>

{% if distance %}
<div class="box">
    <h3>ğŸ›° Distance: {{ distance }} million km</h3>
    <h3>â³ One-way Signal Delay: {{ delay }} minutes</h3>
    <h3>ğŸ” Round Trip Delay: {{ round_trip }} minutes</h3>
</div>
{% endif %}

{% if message %}
<div class="box">
    <h2>{{ message }}</h2>
    <h3>ğŸ¤– Mars Reply: {{ mars_reply }}</h3>
</div>
{% endif %}

{% if graph %}
<div class="box">
    <h3>ğŸ“Š Communication Delay Graph</h3>
    <img src="data:image/png;base64,{{ graph }}" />
</div>
{% endif %}

{% if image_url %}
<div class="box">
    <h3>ğŸ›° NASA Astronomy Picture of the Day</h3>
    <h4>{{ image_title }}</h4>
    <img src="{{ image_url }}" width="400px">
    <p style="max-width:600px; margin:auto;">
        {{ image_explanation }}
    </p>
</div>
{% endif %}
<div class="box">
    <h3>ğŸ›° Live ISS Satellite Tracking</h3>
    <div id="map" style="height:400px;"></div>
</div>
</div>
</body>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
    // Initialize map
    var map = L.map('map').setView([0, 0], 2);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    var issIcon = L.icon({
        iconUrl: 'https://cdn-icons-png.flaticon.com/512/3212/3212608.png',
        iconSize: [40, 40]
    });

    var marker = L.marker([0, 0], { icon: issIcon }).addTo(map);

    async function updateISS() {
        const response = await fetch('https://api.wheretheiss.at/v1/satellites/25544');
        const data = await response.json();

        const lat = data.latitude;
        const lon = data.longitude;

        marker.setLatLng([lat, lon]);
        map.setView([lat, lon], 3);
    }

    updateISS();
    setInterval(updateISS, 5000);
</script>
</body>
</html>